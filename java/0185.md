题目编号：185

题目：部门工资

难度：中等

考察范围：SQL

题干：

给定一个 Employee 表，包含员工信息和他们的经理。

+----+-------+--------+-----------+
| Id | Name  | Salary | ManagerId |
+----+-------+--------+-----------+
| 1  | Joe   | 70000  | 3         |
| 2  | Henry | 80000  | 4         |
| 3  | Sam   | 60000  | NULL      |
| 4  | Max   | 90000  | NULL      |
+----+-------+--------+-----------+

编写一个 SQL 查询，该查询可以获取每个部门的工资总和（即如果员工是经理，则将其下属的工资全部计入该经理所在部门）。

根据上述示例，你的查询结果应为：

+-------+--------+
| Name  | Salary |
+-------+--------+
| Max   | 190000 |
| Sam   | 70000  |
+-------+--------+

解题思路：

首先，我们需要将每个员工的工资加上他所在部门的经理的工资，这样才能得到每个部门的工资总和。因此，我们需要使用到连接查询和子查询。

具体来说，我们可以先使用连接查询将每个员工的信息和他所在部门的经理的信息连接起来，然后再使用子查询将每个部门的工资总和计算出来。

解决方案：

```sql
SELECT
    d.Name,
    SUM(e.Salary) AS Salary
FROM
    Employee e
    JOIN
    (
        SELECT
            Id,
            Name
        FROM
            Employee
        WHERE
            ManagerId IS NULL
    ) d
    ON e.ManagerId = d.Id OR e.Id = d.Id
GROUP BY
    d.Name
```

算法复杂度：时间复杂度为 O(n)，空间复杂度为 O(1)。
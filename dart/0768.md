题目编号：768

题目：最多能完成排序的块 II

难度：困难

考察范围：数组、排序

题干：给定一个数组arr，其中有多个重复元素。请你返回能够使得 arr 中所有相等元素块的数量最小。

解题思路：首先，我们需要知道一个性质，即对于一个元素 x，如果它在 arr 中出现了 k 次，那么它必须出现在 k 个连续的块中，且这 k 个块的位置必须是相邻的。因为如果这 k 个块不是相邻的，那么它们就可以被合并成更少的块。

接下来，我们考虑如何求出最小的块数。我们可以使用贪心的思想，从左到右遍历数组，维护一个当前块的最大值 max，以及一个当前块的最小值 min。如果当前元素比 max 大，那么它必须单独成为一个块，否则它可以加入当前块中。如果当前元素比 min 小，那么我们需要将当前块拆分成多个块，其中最后一个块的最大值为当前元素，其余块的最大值为 max。

解决方案：

```dart
int maxChunksToSorted(List<int> arr) {
  int n = arr.length;
  int ans = 0;
  int max = 0;
  int min = n;
  for (int i = 0; i < n; i++) {
    max = max(max, arr[i]);
    min = min(min, arr[i]);
    if (max == i) {
      ans++;
      max = 0;
      min = n;
    }
  }
  return ans;
}
```

算法复杂度：时间复杂度为 O(n)，空间复杂度为 O(1)。
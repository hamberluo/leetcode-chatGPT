题目编号：591

题目：标签验证器

难度：困难

考察范围：字符串处理、正则表达式

题干：给定一个表示 HTML 代码的字符串，包含标签、属性和内容等信息。请编写一个标签验证器，可以验证输入的字符串是否有效。

解题思路：本题可以使用正则表达式来解决。首先，我们需要了解 HTML 标签的基本结构，如下所示：

```darthtml
<tagname attribute1="value1" attribute2="value2">content</tagname>
```

其中，`tagname` 表示标签名，`attribute` 表示标签的属性，`content` 表示标签的内容。在本题中，我们需要验证输入的字符串是否符合这个基本结构，同时还需要考虑以下几个问题：

1. 标签名必须符合以下规则：
   - 由小写字母组成
   - 长度在 1 到 9 之间
2. 属性名必须符合以下规则：
   - 由小写字母组成
   - 长度在 1 到 9 之间
3. 属性值必须符合以下规则：
   - 可以是双引号或单引号括起来的任意字符串
   - 如果使用双引号，则字符串中不能包含双引号，如果使用单引号，则字符串中不能包含单引号
4. 标签的内容可以是任意字符串，但不能包含 `<` 和 `>` 符号

根据上述规则，我们可以使用正则表达式来验证输入的字符串是否符合要求。具体来说，我们可以使用以下正则表达式：

```dart
RegExp r = RegExp(r'^<([a-z]{1,9})\s*([a-z]{1,9})\s*=\s*("[^"]*"|\'[^\']*\')(\s+[a-z]{1,9}\s*=\s*("[^"]*"|\'[^\']*\'))*\s*>([^<>]*)<\/\1>');
```

该正则表达式的含义如下：

- `^` 表示字符串的开头
- `<` 表示一个左尖括号
- `([a-z]{1,9})` 表示一个标签名，由小写字母组成，长度在 1 到 9 之间，使用括号捕获该部分内容
- `\s*` 表示零个或多个空格
- `([a-z]{1,9})` 表示一个属性名，由小写字母组成，长度在 1 到 9 之间，使用括号捕获该部分内容
- `\s*=\s*` 表示一个等号，两边可以有零个或多个空格
- `("[^"]*"|\'[^\']*\')` 表示一个属性值，可以是双引号或单引号括起来的任意字符串，使用括号捕获该部分内容
- `(\s+[a-z]{1,9}\s*=\s*("[^"]*"|\'[^\']*\'))*` 表示零个或多个属性，每个属性由一个或多个空格、一个属性名、一个等号、一个属性值组成，使用括号捕获每个属性的内容
- `\s*` 表示零个或多个空格
- `>` 表示一个右尖括号
- `([^<>]*)` 表示标签的内容，可以是任意字符串，但不能包含 `<` 和 `>` 符号，使用括号捕获该部分内容
- `<\/\1>` 表示一个结束标签，由一个左尖括号、一个斜杠、一个与开始标签相同的标签名、一个右尖括号组成，使用 `\1` 表示与开始标签相同的标签名
- `` 表示字符串的结尾

如果输入的字符串符合上述正则表达式的要求，则说明该字符串是一个有效的 HTML 标签，否则说明该字符串无效。

解决方案：

```dart
bool isValid(String code) {
  RegExp r = RegExp(r'^<([a-z]{1,9})\s*([a-z]{1,9})\s*=\s*("[^"]*"|\'[^\']*\')(\s+[a-z]{1,9}\s*=\s*("[^"]*"|\'[^\']*\'))*\s*>([^<>]*)<\/\1>');
  if (!r.hasMatch(code)) {
    return false;
  }
  List<String> stack = [];
  for (int i = 0; i < code.length;) {
    if (i > 0 && stack.isEmpty) {
      return false;
    }
    if (code.startsWith('<![CDATA[', i)) {
      int j = i + '<![CDATA['.length;
      i = code.indexOf(']]>', j);
      if (i == -1) {
        return false;
      }
      i += ']]>'.length;
    } else if (code.startsWith('</', i)) {
      int j = i + '</'.length;
      i = code.indexOf('>', j);
      if (i == -1) {
        return false;
      }
      String tag = code.substring(j, i);
      if (stack.isEmpty || stack.last != tag) {
        return false;
      }
      stack.removeLast();
      i += '>'.length;
    } else if (code.startsWith('<', i)) {
      int j = i + '<'.length;
      i = code.indexOf('>', j);
      if (i == -1) {
        return false;
      }
      String tag = code.substring(j, i);
      if (!r.hasMatch('<tag>')) {
        return false;
      }
      stack.add(tag);
      i += '>'.length;
    } else {
      i++;
    }
  }
  return stack.isEmpty;
}
```

算法复杂度：时间复杂度为 O(n)，其中 n 是输入字符串的长度。空间复杂度为 O(n)，其中 n 是输入字符串的长度，主要是用于存储标签名的栈。
题目编号：335

题目：路径交叉

难度：困难

考察范围：数学、模拟

题干：给定一个含有 n 个正整数的数组 x。从点 (0,0) 开始，先向北移动 x[0] 米，然后向西移动 x[1] 米，向南移动 x[2] 米，向东移动 x[3] 米，持续进行这种移动方式，直到行走完所有的指令。即从第 i 个指令到第 i+1 个指令（i 从 0 开始）的移动方式为：

- 北 x[2i] 米，其中 2i 是偶数；
- 西 x[2i+1] 米，其中 2i+1 是奇数；
- 南 x[2i+2] 米，其中 2i+2 是偶数；
- 东 x[2i+3] 米，其中 2i+3 是奇数。

此外，我们定义一个有效路径为任意相邻两个点之间的连接线都与坐标轴形成 45 度角（例如，除了初始点和目标点，路径上没有任何 90 度角的拐点）。

注意：在真实的情况下，记录路线的数组可能会很长。请尝试以尽可能快的速度解决此问题。

示例 1：

输入: [2,1,1,2]
输出: true

示例 2：

输入: [1,2,3,4]
输出: false 

解题思路：模拟

首先，我们可以将路径分为两类：向北或向南的路径和向西或向东的路径。对于向北或向南的路径，我们可以将其看作是在 y 轴上的移动，对于向西或向东的路径，我们可以将其看作是在 x 轴上的移动。因此，我们可以分别计算在 x 轴和 y 轴上的移动距离，然后判断是否存在交叉。

具体来说，我们可以使用四个变量 x1, y1, x2, y2 分别表示当前点和前一个点在 x 轴和 y 轴上的坐标。对于每个指令，我们根据其奇偶性来判断其移动方向，并更新 x1, y1, x2, y2。然后，我们判断当前路径是否与之前的路径相交，如果相交，则返回 true。

判断路径是否相交的方法如下：对于向北或向南的路径，我们只需要判断当前路径是否与之前的路径在 x 轴上有交叉；对于向西或向东的路径，我们只需要判断当前路径是否与之前的路径在 y 轴上有交叉。

解决方案：

```ruby
def is_self_crossing(x)
  x1, y1, x2, y2, n = 0, 0, 0, 0, x.size
  (0...n).each do |i|
    if i % 4 == 0
      y2 += x[i]
      if y2 <= y1 && y2 >= y1 - x2 && x1 >= x2 && i >= 3
        return true
      end
    elsif i % 4 == 1
      x2 -= x[i]
      if x2 <= x1 && x2 >= x1 - y2 && y1 >= y2
        return true
      end
    elsif i % 4 == 2
      y2 -= x[i]
      if y2 >= y1 && y2 <= y1 + x2 && x1 <= x2 - x[i - 1]
        return true
      end
    else
      x2 += x[i]
      if x2 >= x1 && x2 <= x1 + y2 && y1 <= y2 - x[i - 1]
        return true
      end
    end
    x1, y1 = x2, y2
  end
  false
end
```

算法复杂度：时间复杂度为 O(n)，空间复杂度为 O(1)。
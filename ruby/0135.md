题目编号：135

题目：分发糖果

难度：困难

考察范围：贪心算法

题干：给定一个数组 ratings，代表孩子们的评分。每个孩子都有一个糖果，你需要按照以下规则给孩子们分糖果：

1. 每个孩子至少分配到 1 个糖果。
2. 相邻的孩子中，评分高的孩子必须获得更多的糖果。

要求：最少需要准备多少颗糖果？

解题思路：首先，每个孩子至少分配到 1 个糖果，所以我们可以先将每个孩子的糖果数都初始化为 1。然后，我们从左到右遍历一遍数组，如果当前孩子的评分比前一个孩子高，那么当前孩子的糖果数就比前一个孩子多 1。接着，我们再从右到左遍历一遍数组，如果当前孩子的评分比后一个孩子高，并且当前孩子的糖果数不大于后一个孩子的糖果数，那么当前孩子的糖果数就要比后一个孩子多 1。最后，我们将所有孩子的糖果数加起来，就是最少需要准备的糖果数。

解决方案：

```ruby
def candy(ratings)
  n = ratings.size
  candies = Array.new(n, 1)
  (1...n).each do |i|
    candies[i] = candies[i - 1] + 1 if ratings[i] > ratings[i - 1]
  end
  (n - 2).downto(0).each do |i|
    candies[i] = [candies[i], candies[i + 1] + 1].max if ratings[i] > ratings[i + 1]
  end
  candies.sum
end
```

算法复杂度：时间复杂度为 O(n)，空间复杂度为 O(n)。
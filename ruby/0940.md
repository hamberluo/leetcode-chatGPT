题目编号：940

题目：不同的子序列 II

难度：困难

考察范围：动态规划

题干：给定一个字符串 S，计算 S 的不同非空子序列的个数。因为结果可能很大，所以返回答案模 10^9 + 7。

解题思路：本题可以使用动态规划来解决。我们可以定义一个数组 dp，其中 dp[i] 表示以 S[i] 结尾的子序列的个数。对于 S[i]，它可以单独作为一个子序列，也可以和前面的字符组成新的子序列。如果 S[i] 之前没有出现过，那么以 S[i] 结尾的子序列个数为 2 * dp[i-1] + 1，其中 1 表示单独作为一个子序列。如果 S[i] 之前出现过，那么以 S[i] 结尾的子序列个数为 2 * dp[i-1] - dp[j-1]，其中 j 是 S[i] 上一次出现的位置。

解决方案：

```ruby
MOD = 10**9 + 7

def distinct_subseq_ii(s)
  n = s.size
  dp = Array.new(n, 0)
  last = {}
  dp[0] = 1
  last[s[0]] = 0
  (1...n).each do |i|
    dp[i] = (2 * dp[i-1]) % MOD
    if last.key?(s[i])
      j = last[s[i]]
      dp[i] = (dp[i] - dp[j-1] + MOD) % MOD
    end
    last[s[i]] = i
  end
  dp[n-1]
end
```

算法复杂度：时间复杂度为 O(n)，空间复杂度为 O(n)。
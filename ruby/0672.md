题目编号：672

题目：灯泡开关 Ⅱ

难度：中等

考察范围：数学、逻辑

题干：现有一个房间，墙上挂有 n 只已经打开的灯泡和 4 个按钮。在进行了 m 次未知操作后，你需要返回这 n 只灯泡可能有多少种不同的状态。假设这 n 只灯泡初始状态都是关闭的。

操作具体信息如下：

每次操作可以选择一个按钮进行按下，下面将会对所有的灯进行以下操作：

    将所有的灯的状态反转（即开变为关，关变为开）
    将编号为 i 的倍数的灯进行状态反转
    将编号为 i + k * i（k 为整数）的灯进行状态反转

解题思路：数学、逻辑

对于每个灯泡，我们可以记录下来它被按下的次数，因为按下偶数次相当于没有按下，按下奇数次相当于被反转了一次。而每个按钮的操作都是对于某些灯泡进行反转，因此我们可以记录下来每个按钮对哪些灯泡进行了反转。

对于第一个按钮，它会对所有的灯泡进行反转，因此每个灯泡都会被按下一次，即被反转一次。

对于第二个按钮，它会对所有编号为奇数的灯泡进行反转，因此每个奇数编号的灯泡都会被按下一次，即被反转一次。

对于第三个按钮，它会对所有编号为偶数的灯泡进行反转，因此每个偶数编号的灯泡都会被按下一次，即被反转一次。

对于第四个按钮，它会对所有编号为 3k+1 的灯泡进行反转，因此每个编号为 3k+1 的灯泡都会被按下一次，即被反转一次。

综上所述，对于每个灯泡，它被按下的次数就是它的编号的因子个数。而每个灯泡的状态只有两种可能，因此总状态数就是 2 的灯泡个数次方。

解决方案：

```ruby
def flip_lights(n, m)
  return 1 if m == 0
  return 2 if n == 1 && m == 1
  return 3 if n == 2 && m == 1
  return 4 if n == 1 && m == 2
  return 7 if n == 2 && m == 2
  return 8 if n >= 3 && m == 1
  return 8 if n == 2 && m >= 3
  return 8 if n >= 3 && m == 2
  return 8 if n >= 3 && m >= 3
  return 2 if n == 1
  return 4 if n == 2
  return 7 if n >= 3
end
```

算法复杂度：时间复杂度为 O(1)，空间复杂度为 O(1)。